
----
[네트워크 설정]
 
이더넷 카드가 2개 이상 설치되어 있을 때 eth0는 외부 인터넷, eth1은 내부 내트워크용으로만 사용할 경우,
 기본 게이트웨이를 설정하는 방법입니다.
(참고) 랜카드가 n개 설치 되어 있다며  eth0, eth1, eth2, ..., eth(n-1) 으로 명명되어 집니다.
 
1. 현재 라우팅 테이블 정보 보기
# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
112.168.234.128 *               255.255.255.192 U     0      0        0 eth0
192.168.0.0     *               255.255.255.0   U     0      0        0 eth1
169.254.0.0     *               255.255.0.0     U     0      0        0 eth1
 
2. 기본 게이트웨이 설정하기 
 # route add default 112.168.234.129 eth0
 
3. 설정상태 확인
# route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
112.168.234.128 *               255.255.255.192 U     0      0        0 eth0
192.168.0.0     *               255.255.255.0   U     0      0        0 eth1
169.254.0.0     *               255.255.0.0     U     0      0        0 eth1
default         112.168.234.129 0.0.0.0         UG    0      0        0 eth0        <-- 디폴트게이트웨이가 추가된 상태
  
4. 설정이 변경되면 네트워크를 재시작 해줍니다. 
# /etc/rc.d/init.d/network restart
또는
# service network restart
 
(*) 혹, ping 이 외부로 나가지 않을 경우, 아래의 '5) /etc/sysconfig/network' 항목에 'GATEWAYDEV=eth0' 이 항목을 설정해 보십시요
 
---------------------------------------------------------------------------------

[기타 네트워크 설정과 관련된 파일들]
 
- (참고) 설정과 관련된 설정 파일들은 주로 /etc 경로에 위치합니다.
 
1) hostname
  > 호스트명 정보를 읽거나 수정하는 명령( '/etc/sysconfig/network' 파일에 HOSTNAME도 수정해 주세요) 
 
(예)
# hostname                     <-- 호스트명 알아오기
media
#hostname myserver       <-- 호스트명을 myserver로 변경
 
 
2) /etc/resolv.conf
   > 도메인 및 DNS 서버 설정파일 파일
- 'nameserver' :  DNS 서버 주소
- 'search' : 특정 도메인을 설정해 두면 DNS 서버에 질의할 때 여기에서 지정한 도메인을 덧붙여서 먼저 찾게 된다. 예로 'search mysite.com' 으로 설정되었고, telnet myhost라고 접속 명령을 치면 myhost로 검색를 들면, 'search'에 설정된 도메인을 덧 붙여 myhost.mysite.com을 먼저 DNS에 검색하도록 한다.
 
 (예)
- 자체 DNS(192.168.234.131)운영하는 경우
# cat /etc/resolv.conf
; generated by /sbin/dhclient-script
search mysite.com
nameserver 192.168.234.131
nameserver 168.126.63.1
nameserver 168.126.63.2
 
 
3) /etc/hosts
  > DNS에 질의 전 우선하는 호스트 정보(ip, named address)를 설정하는 파일
 (예)
# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1               localhost.localdomain localhost myhost
192.168.0.12          fileserver
 
 
4) /etc/host.conf
 > DNS와 hosts 파일 중 호스명이 IP주소로 변환될때 먼저 사용할 것인지의 순서를 설정하는 파일
- multi on 옵션은 /etc/hosts 파일에 하나의 호스트에 대해 여러 개의 IP 주소를 설정할 수 있다는 옵션.
(예) 아래의 bind라 하면 DSN를 말하는 것으로 호스트를 찾는 순서는 /etc/hosts파일을 우선하고 없는경우 DNS에 질의합니다.
 
# cat /etc/host.conf
order hosts,bind
multi on
 
 
5) /etc/sysconfig/network
  > 호스트명, 게이트웨이,네트워크 사용여부 등을 설정하는 파일
(예)
# cat /etc/sysconfig/network
NETWORKING=yes
NETWORKING_IPV6=yes
HOSTNAME=media
GATEWAY=192.168.0.16
GATEWAYDEV=eth0                     <--디폴트 게이트웨이로 나가는 네트워크 카드가  eth0 으로 설정

----


Ubuntu 14.04.2 기준으로 쓰여짐.

아래의 bash script를 파일로 만든다음, /etc/network/interfaces에서 해당 NIC이 up 된 후에 실행되도록 해준다. 마지막 두줄은 외부 인터넷에 연결되는 NIC에만 적용해주고, 나머지 NIC 스크립트에서는 제거해준다.


NAME=NICNAME(ex. eth0)
MAC=WRITE:YOUR:NIC:MAC:ADDRESS:HERE

IP=$(ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://')
IP1=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $1}'`
IP2=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $2}'`
IP3=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $3}'`
IP4=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $4}'`

ip route add $IP1.$IP2.$IP3.0 dev $NAME src $IP table $NAME
ip route add default via $IP1.$IP2.$IP3.254 dev $NAME table $NAME

ip rule add from $IP table $NAME
ip rule add to $IP table $NAME

ip route flush cache

route del default dev $NAME
sleep 2
route add default gw $IP1.$IP2.$IP3.254 dev $NAME
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
NAME=NICNAME(ex. eth0)
MAC=WRITE:YOUR:NIC:MAC:ADDRESS:HERE
 
IP=$(ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://')
IP1=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $1}'`
IP2=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $2}'`
IP3=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $3}'`
IP4=`ifconfig | grep $MAC -A 1 | awk '/'$NAME'/{getline; print}' | sed 's/\ \ Bcast.*$//' | sed 's/^.*addr://' | awk -F. '{print $4}'`
 
ip route add $IP1.$IP2.$IP3.0 dev $NAME src $IP table $NAME
ip route add default via $IP1.$IP2.$IP3.254 dev $NAME table $NAME
 
ip rule add from $IP table $NAME
ip rule add to $IP table $NAME
 
ip route flush cache
 
route del default dev $NAME
sleep 2
route add default gw $IP1.$IP2.$IP3.254 dev $NAME
유동아이피를 사용중이라 스크립트가 복잡한데, 고정아이피라면 더 간단히 할 수 있을 듯 싶다.

/etc/network/interfaces에 추가 방법은 이렇다.


auto eth0
iface eth0 inet dhcp
  post-up /root/eth0.sh
1
2
3
auto eth0
iface eth0 inet dhcp
  post-up /root/eth0.sh
 Reference
Configuring Multiple Default Routes in Linux
=----
두개의 NIC 이용
http://capsuleer.tistory.com/97